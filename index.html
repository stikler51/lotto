<!DOCTYPE html>

<html>

<head>
  <title>Rigid body - Physijs</title>
  
  <link rel="stylesheet" type="text/css" href="js/physijs/examples/css/styles.css"/>
  <link rel="stylesheet" type="text/css" href="style.css"/>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.js"></script>
  <script type="text/javascript" src="js/physijs/physi.js"></script>
  <script src="js/OrbitControls.js"></script>
  <script src="js/md5.js"></script>
  
  <script type="text/javascript">

      Physijs.scripts.worker = 'js/physijs/physijs_worker.js';
      Physijs.scripts.ammo = 'examples/js/ammo.js';

      var initScene, render, loader, renderer, scene, ground, camera;
      var texture = new THREE.TextureLoader().load( "assets/Stage.png" );

      initScene = async function () {
          

          const winningBallsAllRounds = await getWinningBalls()
              .then(data => data);
          
          console.log(winningBallsAllRounds);
          
          renderer = new THREE.WebGLRenderer({antialias: true});
          renderer.setSize(window.innerWidth, window.innerHeight);
          renderer.setClearColor('skyblue');
          renderer.powerPreference = 'high-performance';
          renderer.shadowMap.enabled = false;
          renderer.shadowMapSoft = false;
          document.getElementById('viewport').appendChild(renderer.domElement);

          scene = new Physijs.Scene;
          scene.background = texture;
          scene.setGravity(new THREE.Vector3(0, -500, 0));
          scene.addEventListener(
              'update',
              function () {
                  scene.simulate(undefined, 1);
              }
          );

          camera = new THREE.PerspectiveCamera(
              35,
              window.innerWidth / window.innerHeight,
              1,
              1000
          );
          camera.position.set(0, 20, 800);
          camera.lookAt({x: 0, y: 20, Z: 0});
          scene.add(camera);

          // var controls = new THREE.OrbitControls(camera, renderer.domElement);

          // Light
          var ambientLight = new THREE.AmbientLight(0xFFFFFF, 0.9); // soft white light (мягкий белый свет)
          scene.add(ambientLight);
          
          // Loader
          loader = new THREE.TextureLoader();
          
          var balls = [
              [
                  makeBall(-15, 70, 10, 0),
                  makeBall(-15, 80, 10, 1),
                  makeBall(-15, 90, 10, 2),
                  makeBall(-15, 100, 10, 3),
                  makeBall(-15, 110, 10, 4),
                  makeBall(-15, 120, 10, 5),
                  makeBall(-15, 130, 10, 6),
                  makeBall(-15, 140, 10, 7),
                  makeBall(-15, 157, 10, 8),
                  makeBall(-15, 160, 10, 9),
              ],
              [
                  makeBall(-5, 70,  10, 0),
                  makeBall(-5, 80,  10, 1),
                  makeBall(-5, 90,  10, 2),
                  makeBall(-5, 100, 10, 3),
                  makeBall(-5, 110, 10, 4),
                  makeBall(-5, 120, 10, 5),
                  makeBall(-5, 130, 10, 6),
                  makeBall(-5, 140, 10, 7),
                  makeBall(-5, 157, 10, 8),
                  makeBall(-5, 160, 10, 9),
              ],
              [
                  makeBall(5, 70,  10, 0),
                  makeBall(5, 80,  10, 1),
                  makeBall(5, 90,  10, 2),
                  makeBall(5, 100, 10, 3),
                  makeBall(5, 110, 10, 4),
                  makeBall(5, 120, 10, 5),
                  makeBall(5, 130, 10, 6),
                  makeBall(5, 140, 10, 7),
                  makeBall(5, 157, 10, 8),
                  makeBall(5, 160, 10, 9),
              ],
              [
                  makeBall(15, 70, 10, 0),
                  makeBall(15, 80, 10, 1),
                  makeBall(15, 90, 10, 2),
                  makeBall(15, 100, 10, 3),
                  makeBall(15, 110, 10, 4),
                  makeBall(15, 120, 10, 5),
                  makeBall(15, 130, 10, 6),
                  makeBall(15, 140, 10, 7),
                  makeBall(15, 157, 10, 8),
                  makeBall(15, 160, 10, 9),
              ]
          ];

          function ballPull() {
              return [
                  [
                      makeBall(-15, 137, 10, 0),
                      makeBall(-15, 137, 10, 1),
                      makeBall(-15, 137, 10, 2),
                      makeBall(-15, 137, 10, 3),
                      makeBall(-15, 137, 10, 4),
                      makeBall(-15, 137, 10, 5),
                      makeBall(-15, 137, 10, 6),
                      makeBall(-15, 137, 10, 7),
                      makeBall(-15, 137, 10, 8),
                      makeBall(-15, 137, 10, 9)
                  ],
                  [
                      makeBall(-5, 137, 10, 0),
                      makeBall(-5, 137, 10, 1),
                      makeBall(-5, 137, 10, 2),
                      makeBall(-5, 137, 10, 3),
                      makeBall(-5, 137, 10, 4),
                      makeBall(-5, 137, 10, 5),
                      makeBall(-5, 137, 10, 6),
                      makeBall(-5, 137, 10, 7),
                      makeBall(-5, 137, 10, 8),
                      makeBall(-5, 137, 10, 9)
                  ],
                  [
                      makeBall(5, 137, 10, 0),
                      makeBall(5, 137, 10, 1),
                      makeBall(5, 137, 10, 2),
                      makeBall(5, 137, 10, 3),
                      makeBall(5, 137, 10, 4),
                      makeBall(5, 137, 10, 5),
                      makeBall(5, 137, 10, 6),
                      makeBall(5, 137, 10, 7),
                      makeBall(5, 137, 10, 8),
                      makeBall(5, 137, 10, 9)
                  ],
                  [
                      makeBall(15, 137, 10, 0),
                      makeBall(15, 137, 10, 1),
                      makeBall(15, 137, 10, 2),
                      makeBall(15, 137, 10, 3),
                      makeBall(15, 137, 10, 4),
                      makeBall(15, 137, 10, 5),
                      makeBall(15, 137, 10, 6),
                      makeBall(15, 137, 10, 7),
                      makeBall(15, 137, 10, 8),
                      makeBall(15, 137, 10, 9)

                  ]
              ];
          }
          
          var stoppers = [
              makeStopper(-15),
              makeStopper(-5),
              makeStopper(5),
              makeStopper(15)
          ];
          
          let frontWall = makeContainer();
          
          makeGlass();
          
          let speed = 0;

          makeTubes();
          
          makeBallsExit();

          let stopWall = makeStopWall();

          makeCatchingBox();
          
          let round = 1;
          
          var iteration = 0;

          var topWall = makeTopWall();

          balls.forEach((item => {
              item.forEach((ball => {
                  scene.add(ball);
              }))
          }));

          let ballNum = 0;
          let winningBallsPull = [];
          
          function addBallsToScene() {
              for (let j = 0; j < 4; j++) {
                  scene.add(balls[j][ballNum])
              }
          };
          
          function removeWinnigBalls(ball) {
              scene.remove(ball);
              ball.position.z = -10;
              scene.add(ball);
              
              setTimeout(()=> {
                  scene.remove(ball);
              }, 500);
          }

          let winningBalls = winningBallsAllRounds[round].split('');
          
              function startGame() {
              scene.add(stopWall);
              frontWall.remove(topWall);
              scene.add(frontWall);
              scene.remove(stoppers[iteration]);
              
              setTimeout(() => {
                  
                  frontWall.add(topWall);
                  scene.add(frontWall);
                  scene.setGravity(new THREE.Vector3(0, -400, 0));

                  let timer = setInterval(() => {
                      speed += 0.02;
                      if (speed >= 0.12) {
                          clearInterval(timer);
                      }
                  }, 500)
              }, 2500);

              // pull winning ball, stop rotating
              setTimeout(() => {
                  let winningBall = winningBalls[iteration];
                  scene.remove(balls[iteration][winningBall]);
                  balls[iteration][winningBall].position.z = 48;
                  balls[iteration][winningBall].position.y = -50;
                  balls[iteration][winningBall].position.x = 0;
                  scene.add(balls[iteration][winningBall]);

                  winningBallsPull[iteration] = balls[iteration][winningBall];
                  let ballCont = document.body.querySelector(`.winning-${iteration}`);
                  
                  let img = document.createElement('img');
                  img.src = `assets/balls/balls/Ball_${winningBall}.png`;
                  ballCont.appendChild(img);
                  
                  var index = balls[iteration].indexOf(balls[iteration][winningBall]);
                  if (index !== -1) balls[iteration].splice(index, 1);
  
                  setTimeout(() => {
                      var timerB = setInterval(() => {
                          if (balls[iteration].length === 0) {
                              clearInterval(timerB);
                              let timer = setInterval(() => {
                                  if (speed > 0.06) {
                                      speed -= 0.05;
                                  }
                                  
                                  if (frontWall.rotation.z <= 0.3 && frontWall.rotation.z >= -0.3) {
                                      speed = 0;
                                      frontWall.rotation.z = 0;

                                      clearInterval(timer);
                                      if (iteration < 4) {
                                          iteration += 1;
                                          if (iteration === 4) {
                                              setTimeout(() => {
                                                  document.body.querySelectorAll('.win').forEach(item => {
                                                      item.innerHTML = '';
                                                  });
                                                  
                                                  let winStr = `${winningBalls[0]} ${winningBalls[1]} ${winningBalls[2]} ${winningBalls[3]}`;
                                                  document.body.querySelectorAll(`.round-${round}`).forEach(item => {
                                                    item.innerHTML = winStr;
                                                  });
                                                  round += 1;
                                                  if (round > 23) {
                                                      return;
                                                  }

                                                  winningBalls = winningBallsAllRounds[round].split('');
                                                  let ballNum = 0;
                                                  let removeWinBalls = setInterval(() => {
                                                      removeWinnigBalls(winningBallsPull[ballNum]);
                                                      ballNum++;
                                                      if(ballNum >= 4) {
                                                          clearInterval(removeWinBalls);
                                                          ballNum = 0;
                                                      }
                                                  }, 500);
                                              }, 500);
                                              
                                              setTimeout(() => {
                                                  stoppers.forEach((item) => {
                                                      scene.add(item);
                                                  });
                                                  
                                                  balls = ballPull();

                                                  let int = setInterval(() => {
                                                      addBallsToScene();
                                                      ballNum++;
                                                      if(ballNum >= 10) {
                                                          clearInterval(int);
                                                          ballNum = 0;
                                                      }
                                                  }, 250);
                                                  iteration = 0;
                                                  return;
                                              }, 3000)
                                          } else {
                                              startGame();
                                          }
                                      }
                                  }
                              }, 200);
                          } else {
                              scene.remove(balls[iteration][0]);
                              balls[iteration][0].position.z = -20;
                              balls[iteration][0].position.x = 0;
                              balls[iteration][0].position.y = -30;
                              scene.add(balls[iteration][0]);
                              setTimeout(() => {
                                  scene.remove(balls[iteration][0]);
                                  balls[iteration].splice(0, 1);
                              }, 400);

                          }

                      }, 500);


                  }, 500)
              }, 12000)
          };
          
          const startBtn = document.querySelector('.start_btn');
          startBtn.addEventListener('click', startGame);
          updateTime();

          setInterval(() => {
              updateTime();
          }, 10000);

          render = function () {
              requestAnimationFrame(render);

              frontWall.rotation.z += speed;
              
              frontWall.__dirtyRotation = true;

              renderer.render(scene, camera);

          };

          scene.simulate();
          
          requestAnimationFrame(render);
      
      };

      window.onload = initScene;
      
      function makeStopper(x) {
          var ground_material = Physijs.createMaterial(
              new THREE.MeshBasicMaterial({
                  color: 'red',
                  opacity: 0,
                  transparent: true,
                  side: THREE.DoubleSide,
              }),
              0.9,
              0);

          var stopper = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(10, 10, 1),
              ground_material,
              0, // mass
          );
          
          stopper.rotation.x = Math.PI / 2;
          stopper.position.y = 60;
          stopper.position.z = 10;
          stopper.position.x = x;
          
          scene.add(stopper);
          
          return stopper;
      }
      
      function makeCatchingBox() {
          var ground_material = Physijs.createMaterial(
              new THREE.MeshBasicMaterial({
                  color: 'black',
                  opacity: 1,
                  transparent: true,
                  side: THREE.DoubleSide,
              }),
              0.9,
              0);

          var floor = new Physijs.BoxMesh(
              new THREE.PlaneGeometry(105, 50, 1),
              ground_material,
              0, // mass
          );
          floor.position.z = -35;
          floor.rotation.x = Math.PI / 2;
          floor.position.y = -100;

          var wall = new Physijs.BoxMesh(
              new THREE.PlaneGeometry(105, 100, 1),
              ground_material,
              0, // mass
          );
          
          wall.position.y = -25;
          wall.position.z = -45;
          wall.rotation.x = Math.PI / 2;
          
          var rightWall = new Physijs.BoxMesh(
              new THREE.PlaneGeometry(50, 50, 1),
              ground_material,
              0, // mass
          );

          rightWall.rotation.y = Math.PI / 2;
          rightWall.position.x = -52;
          rightWall.position.z = -20;
          // floor.add()
          
          var leftWall = new Physijs.BoxMesh(
              new THREE.PlaneGeometry(50, 50, 1),
              ground_material,
              0, // mass
          );

          leftWall.rotation.y = Math.PI / 2;
          leftWall.position.x = 50;
          leftWall.position.z = -20;
          
          floor.add(rightWall);
          floor.add(leftWall);
          floor.add(wall);
          
          scene.add(floor);
      }
      
      function makeBallsExit() {
          var ground_material = Physijs.createMaterial(
              new THREE.MeshBasicMaterial({
                  color: 'red',
                  opacity: 0,
                  transparent: true,
                  side: THREE.DoubleSide,
              }),
              0.9,
              0);
          

          var floor = new Physijs.BoxMesh(
              new THREE.PlaneGeometry(50, 10, 1),
              ground_material,
              0 // mass
          );

          floor.position.y = -67;
          floor.position.z = 46;
          floor.position.x = -20;
          
          floor.rotation.x = Math.PI / 2;
          floor.rotation.y = Math.PI / 30;
          
          var frontWall = new Physijs.BoxMesh(
              new THREE.PlaneGeometry(50, 10, 1),
              ground_material,
              0 // mass
          );

          frontWall.position.y = 5;
          frontWall.position.z = -5;
          // backWall.position.x = -20;

          frontWall.rotation.x = Math.PI / -2;
          
          var backWall = new Physijs.BoxMesh(
              new THREE.PlaneGeometry(50, 10, 1),
              ground_material,
              0 // mass
          );
          
          backWall.position.z = -5;
          backWall.position.y = -5;
          backWall.rotation.x = Math.PI / -2;


          var stopWall = new Physijs.BoxMesh(
              new THREE.PlaneGeometry(10, 10, 1),
              ground_material,
              0 // mass
          );

          stopWall.position.z = -5;
          stopWall.position.x = -25;
          stopWall.position.y = 0;
          stopWall.rotation.x = Math.PI / -2;
          stopWall.rotation.y = Math.PI / 2;
          
          
          floor.add(backWall);
          floor.add(frontWall);
          // floor.add(stopWall);
          
          scene.add(floor);
      }
      
      function makeStopWall() {
          var ground_material = Physijs.createMaterial(
              new THREE.MeshBasicMaterial({
                  color: 'orange',
                  opacity: 0,
                  transparent: true,
                  side: THREE.DoubleSide,
              }),
              0.9,
              0);

          var stopWall = new Physijs.BoxMesh(
              new THREE.PlaneGeometry(10, 10, 1),
              ground_material,
              0 // mass
          );

          stopWall.position.z = 46;
          stopWall.position.x = -45;
          stopWall.position.y = -62;
          stopWall.rotation.x = Math.PI / -2;
          stopWall.rotation.y = Math.PI / 2;
          
          scene.add(stopWall);
          return stopWall;
      }

      function makeTubes() {
          var ground_material = Physijs.createMaterial(
              new THREE.MeshBasicMaterial({
                  color: 'green',
                  opacity: 0,
                  transparent: true,
                  side: THREE.DoubleSide,
              }),
              0.9,
              0);

          var frontWallTube = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(40, 110, 1),
              ground_material,
              0 // mass
          );
          
          frontWallTube.position.y = 95;
          frontWallTube.position.z = 5;

          var backWallTube = new Physijs.BoxMesh(
              new THREE.BoxGeometry(40, 110, 1),
              ground_material,
              0 // mass
          );

          backWallTube.position.z = 10;

          var rightWallTube = new Physijs.BoxMesh(
              new THREE.BoxGeometry(10, 110, 1),
              ground_material,
              0 // mass
          );

          rightWallTube.position.x = 10;
          rightWallTube.position.z = 5;
          rightWallTube.rotation.y = Math.PI / 2;
          
          var theMostRightWall = rightWallTube.clone();
          theMostRightWall.position.x = 20;
          
          var theMostLeftWall = rightWallTube.clone();
          theMostLeftWall.position.x = -20;
          
          var centerWallTube = rightWallTube.clone();
          centerWallTube.position.x = 0;

          var leftWallTube = rightWallTube.clone();
          leftWallTube.position.x = -10;

          frontWallTube.add(backWallTube);
          frontWallTube.add(rightWallTube);
          frontWallTube.add(centerWallTube);
          frontWallTube.add(leftWallTube);
          frontWallTube.add(theMostRightWall);
          frontWallTube.add(theMostLeftWall);

          scene.add(frontWallTube);
      }
      
      function makeTopWall() {
          var ground_material = Physijs.createMaterial(
              new THREE.MeshBasicMaterial({
                  color: 'orange',
                  opacity: 0,
                  transparent: true,
                  side: THREE.DoubleSide,
              }),
              0.4,
              0.8);
          
          var topWall = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(50, 40, 4),
              ground_material,
              0 // mass
          );
          topWall.position.y = 50;
          topWall.position.z = 20;
          topWall.rotation.x = Math.PI / 2;

          var smasherTop = new Physijs.BoxMesh(
              new THREE.BoxGeometry(10, 10, 40),
              ground_material,
              0 // mass
          );
          
          // smasherTop.position.y = 45;
          smasherTop.position.z = 5;
          smasherTop.rotation.x = Math.PI / 2;
          topWall.add(smasherTop);
          
          

          var leftCornerTop = new Physijs.BoxMesh(
              new THREE.BoxGeometry(45, 40, 4),
              ground_material,
              0 // mass
          );

          leftCornerTop.rotation.y = Math.PI / 4;
          leftCornerTop.position.x = -35;
          leftCornerTop.position.z = 15;

          topWall.add(leftCornerTop);
          
          var rightCornerTop = leftCornerTop.clone();
          rightCornerTop.rotation.y = Math.PI / -4;
          rightCornerTop.position.x = 35;
          rightCornerTop.position.z = 15;

          topWall.add(rightCornerTop);
          
          // scene.add(topWall);
          
          return topWall;
          
      }

      function makeContainer() {
          var ground_material = Physijs.createMaterial(
              new THREE.MeshBasicMaterial({
                  color: 'green',
                  opacity: 0,
                  transparent: true,
                  side: THREE.DoubleSide,
              }),
              0.4,
              0.9);

          var smasher_material = Physijs.createMaterial(
              new THREE.MeshPhongMaterial({
                  color: 'white',
                  // opacity: 1,true,
                  // transparent:
                  // side: THREE.DoubleSide,
              }),
              0.4,
              0.9);

          ground = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(50, 40, 4),
              ground_material,
              0 // mass
          );
          ground.rotation.x = Math.PI / -2;
          ground.position.y = -50;
          ground.position.z = 20;
          //
          var topWall = new Physijs.BoxMesh(
              new THREE.PlaneGeometry(100, 40, 1),
              ground_material,
              0 // mass
          );
          topWall.position.y = 50;
          topWall.position.z = 20;
          topWall.rotation.x = Math.PI / 2;
          //
          var frontWall = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(100, 100, 4),
              ground_material,
              0 // mass
          );
          frontWall.position.z = 0;
          frontWall.rotation.z = 0.1;
          // frontWall.position.x = 0;

          // frontWall.rotation.x = Math.PI / 2;

          var backWall = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(100, 100, 4),
              ground_material,
              0 // mass
          );
          backWall.position.z = 40;

          var rightWall = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(40, 60, 4),
              ground_material,
              0 // mass
          );
          rightWall.position.x = 50;
          rightWall.position.z = 20;
          rightWall.rotation.y = Math.PI / 2;

          var leftWall = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(40, 60, 4),
              ground_material,
              0 // mass
          );
          leftWall.position.x = -50;
          leftWall.position.z = 20;
          leftWall.rotation.y = Math.PI / 2;

          var leftCorner = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(45, 40, 4),
              ground_material,
              0 // mass
          );

          leftCorner.rotation.x = Math.PI / -2;
          leftCorner.rotation.y = Math.PI / 4;
          leftCorner.position.x = -35;
          leftCorner.position.y = -35;
          leftCorner.position.z = 20;

          var leftCornerTop = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(45, 40, 4),
              ground_material,
              0 // mass
          );

          leftCornerTop.rotation.x = Math.PI / -2;
          leftCornerTop.rotation.y = Math.PI / 4;
          leftCornerTop.position.x = 35;
          leftCornerTop.position.y = 35;
          leftCornerTop.position.z = 20;
          //
          var rightCorner = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(45, 40, 4),
              ground_material,
              0 // mass
          );

          rightCorner.rotation.x = Math.PI / 2;
          rightCorner.rotation.y = Math.PI / 4;

          rightCorner.position.x = 35;
          rightCorner.position.y = -35;
          rightCorner.position.z = 20;

          var rightCornerTop = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(45, 40, 4),
              ground_material,
              0 // mass
          );

          rightCornerTop.rotation.x = Math.PI / 2;
          rightCornerTop.rotation.y = Math.PI / 4;

          rightCornerTop.position.x = -35;
          rightCornerTop.position.y = 35;
          rightCornerTop.position.z = 20;


          var smasherBottom = new Physijs.BoxMesh(
              new THREE.BoxBufferGeometry(10, 10, 40),
              ground_material,
              0 // mass
          );

          smasherBottom.position.z = 20;
          smasherBottom.position.y = -46;

          var smasherTop = smasherBottom.clone();
          smasherTop.position.y = 46;

          var smasherLeft = smasherBottom.clone();
          smasherLeft.position.x = -46;
          smasherLeft.position.y = 0;

          var smasherRight = smasherLeft.clone();
          smasherLeft.position.x = 46;

          var FakeSmasherBottom = new THREE.Mesh(
              new THREE.BoxBufferGeometry(10, 0.5, 40, 32),
              smasher_material,
              0 // mass
          );

          FakeSmasherBottom.position.z = 20;
          FakeSmasherBottom.position.y = -40;
          FakeSmasherBottom.rotation.z = Math.PI / 2;

          var fakeSmasherTop = FakeSmasherBottom.clone();
          fakeSmasherTop.position.y = 40;

          var fakeSmasherLeft = FakeSmasherBottom.clone();
          fakeSmasherLeft.rotation.z = Math.PI;
          fakeSmasherLeft.position.x = 40;
          fakeSmasherLeft.position.y = 0;

          var fakeSmasherRight = FakeSmasherBottom.clone();
          fakeSmasherRight.rotation.z = Math.PI;
          fakeSmasherRight.position.x = -40;
          fakeSmasherRight.position.y = 0;

          var mainAxe = new Physijs.CylinderMesh(
              new THREE.CylinderGeometry(0.5, 0.5, 90, 32),
              smasher_material,
              0 // mass
          );

          mainAxe.position.z = -1;

          var addAxe = mainAxe.clone();
          addAxe.rotation.z = Math.PI / 2;

          var centerAxe = new Physijs.CylinderMesh(
              new THREE.CylinderGeometry(1, 1, 40, 32),
              smasher_material,
              0 // mass
          );
          centerAxe.rotation.x = Math.PI / 2;
          centerAxe.position.z = 20;

          mainAxe.add(addAxe);


          //
          // frontWall.add( topWall );
          frontWall.add(ground);
          frontWall.add(backWall);
          frontWall.add(rightWall);
          frontWall.add(leftWall);
          frontWall.add(leftCorner);
          // frontWall.add(leftCornerTop);
          frontWall.add(rightCorner);
          // frontWall.add(rightCornerTop);
          frontWall.add(smasherBottom);
          // frontWall.add(smasherTop);
          frontWall.add(smasherLeft);
          frontWall.add(smasherRight);
          frontWall.add(mainAxe);
          frontWall.add(centerAxe);
          frontWall.add(FakeSmasherBottom);
          frontWall.add(fakeSmasherTop);
          frontWall.add(fakeSmasherLeft);
          frontWall.add(fakeSmasherRight);

          scene.add(frontWall);

          return frontWall;
      }

      function makeBall(x, y, z, imageNum) {
          var geometry = new THREE.BoxGeometry( 1, 1, 1, 12, 12, 12 );
          for ( var i in geometry.vertices ) {
              var vertex = geometry.vertices[ i ];
              vertex.normalize().multiplyScalar(4);
          }

          var image = document.createElement( 'img' );
          image.src = `assets/balls/${imageNum}.png`;

          var texture = new THREE.Texture( image );
          image.addEventListener( 'load', function ( event ) {
              texture.needsUpdate = true;
          } );


          var sideMaterial = Physijs.createMaterial(
              new THREE.MeshBasicMaterial({
                  color: 0xffffff,
                  map: texture,
              }),
              0.4,
              0.6,
          );
          
          var materialArray = [];

          for (let i = 0; i < 6; i++) {
              materialArray.push(sideMaterial);
          }
          
          var ball = new Physijs.SphereMesh(geometry, sideMaterial, 5);
          ball.position.x = x;
          ball.position.y = y;
          ball.position.z = z;
          ball.castShadow = false;
 
          // scene.add(ball);

          return ball;
      }
      
      function makeGlass() {
        var material = new THREE.MeshBasicMaterial({
            map: THREE.ImageUtils.loadTexture('assets/Glass.png'),
            transparent: true,
            opacity: 1,
            color: 0xFFFFFF
        });

        var glass = new Physijs.BoxMesh(
            new THREE.PlaneGeometry(106, 200, 1),
            material,
            0 // mass
        );
        
        glass.position.z = 52;
        glass.position.y = 32;

        var bodyMaterial = new THREE.MeshBasicMaterial({
            map: THREE.ImageUtils.loadTexture('assets/Body-2.png'),
            transparent: true,
            opacity: 1,
            color: 0xFFFFFF
        });

        var body = new Physijs.BoxMesh(
            new THREE.PlaneGeometry(118, 280, 1),
            bodyMaterial,
            0 // mass
        );

        body.position.z = -5;
        body.position.y = 17;
        body.position.x = -2;
        
        scene.add(glass);
        scene.add(body);
    }
    
      function updateTime() {
          let dataContainer = document.body.querySelector('.date');
          let date = new Date();
          let day = date.getDate();
          let month = date.getMonth();
          let year = date.getFullYear();
          
          let hours = date.getHours();
          let minutes = date.getMinutes();

          var ampm = hours >= 12 ? 'PM' : 'AM';
          hours = hours % 12;
          hours = hours ? hours : 12; // the hour '0' should be '12'
          minutes = minutes < 10 ? '0'+minutes : minutes;
          
          
          if (day < 10) {
              day = `0${day}`;
          }

          if (month < 10) {
              month = `0${month}`;
          }

          dataContainer.innerHTML =`${day}-${month}-${year}   ${hours}:${minutes} ${ampm}`;
          
          return `${year}-${month}-${day}`;
      }
      
      async function getWinningBalls() {
          let clientID = 'star99';
          let apiPass = '0123456789';
          let date = updateTime();
          let validationHash = hex_md5(`${clientID}:${date}:${apiPass}`);
          
          let requestString = `http://smartcar.temp.domains/~lotto/api/request.php?client_id=${clientID}&date=${date}&validation=${validationHash}`;

          return await fetch(`https://cors-anywhere.herokuapp.com/${requestString}`).then(resp => resp.json());
      }
    
  
  </script>
</head>

<body>
<div id="viewport"></div>
<button class="start_btn" style="position: absolute; top: 10px; left: 10px;">Start</button>
<div class="date"></div>
<div class="win winning-0"></div>
<div class="win winning-1"></div>
<div class="win winning-2"></div>
<div class="win winning-3"></div>

<table class="score">
  <tr>
    <td></td>
    <td class="round-23" data-attr="23"></td>
  </tr>
  <tr>
    <td></td>
    <td class="round-22" data-attr="22"></td>
  </tr>
  <tr>
    <td></td>
    <td class="round-21" data-attr="21"></td>
  </tr>
  <tr class="separator">
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td class="round-20" data-attr="20"></td>
    <td class="round-19" data-attr="19"></td>
  </tr>
  <tr>
    <td class="round-18" data-attr="18"></td>
    <td class="round-17" data-attr="17"></td>
  </tr>
  <tr>
    <td class="round-16" data-attr="16"></td>
    <td class="round-15" data-attr="15"></td>
  </tr>
  <tr>
    <td class="round-14" data-attr="14"></td>
    <td class="round-13" data-attr="13"></td>
  </tr>
  <tr>
    <td class="round-12" data-attr="12"></td>
    <td class="round-11" data-attr="11"></td>
  </tr>
  <tr class="separator-2">
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td class="round-10" data-attr="10"></td>
    <td class="round-9" data-attr="9"></td>
  </tr>
  <tr>
    <td class="round-8" data-attr="8"></td>
    <td class="round-7" data-attr="7"></td>
  </tr>
  <tr>
    <td class="round-6" data-attr="6"></td>
    <td class="round-5" data-attr="5"></td>
  </tr>
  <tr>
    <td class="round-4" data-attr="4"></td>
    <td class="round-3" data-attr="3"></td>
  </tr>
  <tr>
    <td class="round-2" data-attr="2"></td>
    <td class="round-1" data-attr="1"></td>
  </tr>
</table>

<table class="score-2">
  <tr>
    <td></td>
    <td class="round-23" data-attr="23"></td>
  </tr>
  <tr>
    <td></td>
    <td class="round-22" data-attr="22"></td>
  </tr>
  <tr>
    <td></td>
    <td class="round-21" data-attr="21"></td>
  </tr>
  <tr class="separator">
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td class="round-20" data-attr="20"></td>
    <td class="round-19" data-attr="19"></td>
  </tr>
  <tr>
    <td class="round-18" data-attr="18"></td>
    <td class="round-17" data-attr="17"></td>
  </tr>
  <tr>
    <td class="round-16" data-attr="16"></td>
    <td class="round-15" data-attr="15"></td>
  </tr>
  <tr>
    <td class="round-14" data-attr="14"></td>
    <td class="round-13" data-attr="13"></td>
  </tr>
  <tr>
    <td class="round-12" data-attr="12"></td>
    <td class="round-11" data-attr="11"></td>
  </tr>
  <tr class="separator-2">
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td class="round-10" data-attr="10"></td>
    <td class="round-9" data-attr="9"></td>
  </tr>
  <tr>
    <td class="round-8" data-attr="8"></td>
    <td class="round-7" data-attr="7"></td>
  </tr>
  <tr>
    <td class="round-6" data-attr="6"></td>
    <td class="round-5" data-attr="5"></td>
  </tr>
  <tr>
    <td class="round-4" data-attr="4"></td>
    <td class="round-3" data-attr="3"></td>
  </tr>
  <tr>
    <td class="round-2" data-attr="2"></td>
    <td class="round-1" data-attr="1"></td>
  </tr>
</table>
</body>

</html>
